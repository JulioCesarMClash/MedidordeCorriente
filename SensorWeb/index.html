<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Sensor de Consumo</title>
	<!-- Tell the browser to be responsive to screen width -->
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<!-- Bootstrap 3.3.7 -->
	<link rel="stylesheet" href="./bower_components/bootstrap/dist/css/bootstrap.min.css">
  <!-- Font Awesome 
  <link rel="stylesheet" href="./bower_components/font-awesome/css/font-awesome.min.css">
-->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">


<!-- Ionicons -->
<link rel="stylesheet" href="./bower_components/Ionicons/css/ionicons.min.css">
<!-- Theme style -->
<link rel="stylesheet" href="./dist/css/AdminLTE.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
  	folder instead of downloading all of them to reduce the load. -->
  	<link rel="stylesheet" href="./dist/css/skins/_all-skins.min.css">

  	<!-- Google Font -->
  	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
  </head>

  <body class="hold-transition skin-green-light ">

  	<div class="wrapper">

  		<header class="main-header">
  			<!-- Logo -->
  			<a href="./index2.html" class="logo">
  				<!-- mini logo for sidebar mini 50x50 pixels -->
  				<span class="logo-mini"><b>A</b>LT</span>
  				<!-- logo for regular state and mobile devices -->
  				<span class="logo-lg"><b>Tester</b>LTE</span>
  			</a>
  			<!-- Header Navbar: style can be found in header.less -->
  			<nav class="navbar navbar-static-top">
  				<!-- Sidebar toggle button-->
  				<a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
  					<span class="sr-only">Toggle navigation</span>
  					<span class="icon-bar"></span>
  					<span class="icon-bar"></span>
  					<span class="icon-bar"></span>
  				</a>

  				<div class="navbar-custom-menu">
  					<ul class="nav navbar-nav">
  						<li class="dropdown user user-menu">
  							<a href="#" class="dropdown-toggle" data-toggle="dropdown">
  								<img src="./dist/img/user2-160x160.jpg" class="user-image" alt="User Image">
  								<span class="hidden-xs">Julio </span>
  							</a>
  						</li>
  						<li>
  							<a href="#" data-toggle="control-sidebar"><i class="fas fa-cogs"></i> Cerrar sesión</a>
  						</li>
  					</ul>
  				</div>
  			</nav>
  		</header>

  		<!-- Content Wrapper. Contains page content -->
  		<div class="content-wrapper">
  			<!-- Content Header (Page header) -->
  			<section class="content-header">
  				<h1>
  					Resumen de consumo
  					<small></small>
  				</h1>
  			</section>

  			<!-- Main content -->
  			<section class="content">


  				<div class="row">
  					<div class="col-md-12">


  						<div class="box box-primary">

  							<div class="box-header with-border">
  								<i class="fa fa-bar-chart-o"></i>

  								<h3 class="box-title">Corriente IRMS Registrado [I]</h3>

  								<div class="box-tools pull-left ">
  									<div class="col-md-6">
	  									<div class="box box-primary ">
	  										<button id="btnRefresh" type="button" class="btn btn-xs btn-default">Get History</button>
	  									</div>
	  								</div>	
	  								<div class="col-md-6">
	  									<div class="box box-primary ">
	  										<button id="btnSend" type="button" class="btn btn-xs btn-default">Get Send</button>
	  									</div>
	  								</div>	
  								</div>

  							</div>

  							<div class="box box-primary">

  								<div class="box-body">
	  								<p><i>Introduzca los datos que se le solicitan:</i></p>
	  								<br>
	  								<div class="row">
	  									<div class="col-md-6">
	  										<div class="box box-primary ">
	  											<div class="box box-solid box-primary">
	  												<div class="box-body">
				  										<div class="form-froup">
				  											<label >Id de dispositivo :</label>
				  											<input class="form-control" id="idDevice" type="text" name=""  placeholder="Id Dispositivo">
			  											</div>
			  										</div>
		  										</div>
	  										</div>
	  									</div>
	  								</div>

	  								<div class="row">
										<div class="col-md-6">
											<div class="box box-info">
												<div class="box box-solid box-info">
													<div class="box-body">
														<div class="form-froup">
															<label >Fecha inicial :</label>
															<input class="form-control" id="fmin" type="date" name="">
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="col-md-6">
											<div class="box box-info">
												<div class="box box-solid box-info">
													<div class="box-body">
														<div class="form-froup">
															<label >Hora inicial (Formato 24 Hrs) </label>
															<br>
															<form>
																<label >Hora :</label>
																<select id="hoursfmin">
																	<option value="00">00</option>
																	<option value="01">01</option>
																	<option value="02">02</option>
																	<option value="03">03</option>
																	<option value="04">04</option>
																	<option value="05">05</option>
																	<option value="06">06</option>
																	<option value="07">07</option>
																	<option value="08">08</option>
																	<option value="09">09</option>
																	<option value="10">10</option>
																	<option value="11">11</option>
																	<option value="12">12</option>
																	<option value="13">13</option>
																	<option value="14">14</option>
																	<option value="15">15</option>
																	<option value="16">16</option>
																	<option value="17">17</option>
																	<option value="18">18</option>
																	<option value="19">19</option>
																	<option value="20">20</option>
																	<option value="21">21</option>
																	<option value="22">22</option>
																	<option value="23">23</option>
																</select>
															<br>
															</form>
															<form>
																<label >Minuto :</label>
																<select id="minutesfmin">
																	<option value="00">00</option>
																	<option value="05">05</option>
																	<option value="10">10</option>
																	<option value="15">15</option>
																	<option value="20">20</option>
																	<option value="25">25</option>
																	<option value="30">30</option>
																	<option value="35">35</option>
																	<option value="40">40</option>
																	<option value="45">45</option>
																	<option value="50">50</option>
																	<option value="55">55</option>
																</select>
															</form>
														<br>
														</div>
													</div>
												</div>
											</div>
										</div>
	  								</div>

	  								<div class="row">
	  									<div class="col-md-6">
	  										<div class="box box-info">
												<div class="box box-solid box-info">
													<div class="box-body">
	  													<div class="form-froup">
	  														<label >Fecha final :</label>
	  														<input class="form-control" id="fmax" type="date" name="" >
	  													</div>
	  												</div>
												</div>
											</div>
	  									</div>
	  									<div class="col-md-6">
	  										<div class="box box-info">
												<div class="box box-solid box-info">
													<div class="box-body">
	  													<div class="form-froup">
	  														<label >Hora final (Formato 24 Hrs) </label>
	  														<form>
																<label >Hora :</label>
																<select id="hoursfmax">
																	<option value="00">00</option>
																	<option value="01">01</option>
																	<option value="02">02</option>
																	<option value="03">03</option>
																	<option value="04">04</option>
																	<option value="05">05</option>
																	<option value="06">06</option>
																	<option value="07">07</option>
																	<option value="08">08</option>
																	<option value="09">09</option>
																	<option value="10">10</option>
																	<option value="11">11</option>
																	<option value="12">12</option>
																	<option value="13">13</option>
																	<option value="14">14</option>
																	<option value="15">15</option>
																	<option value="16">16</option>
																	<option value="17">17</option>
																	<option value="18">18</option>
																	<option value="19">19</option>
																	<option value="20">20</option>
																	<option value="21">21</option>
																	<option value="22">22</option>
																	<option value="23">23</option>
																</select>
															<br>
															</form>
															<form>
																<label >Minuto :</label>
																<select id="minutesfmax">
																	<option value="00">00</option>
																	<option value="05">05</option>
																	<option value="10">10</option>
																	<option value="15">15</option>
																	<option value="20">20</option>
																	<option value="25">25</option>
																	<option value="30">30</option>
																	<option value="35">35</option>
																	<option value="40">40</option>
																	<option value="45">45</option>
																	<option value="50">50</option>
																	<option value="55">55</option>
																</select>
															</form>
														<br>
	  													</div>
	  												</div>
												</div>
											</div>
	  									</div>
	  								</div>



									<br>

									<h3 class="box-title">Grafica Historial</h3>

	  								<div id="interactive" style="height: 300px;"></div>

	  								<br>

	  								<br>

	  								<div class="box-body">
		  								<div class="row">
		  									<div class="col-md-6">
		  										<div class="box box-primary ">
		  											<div class="box box-solid box-primary">
		  												<div class="box-body">
					  										<div class="form-froup">
					  											<label >Precio Nominal segun CFE :</label>
					  											<input class="form-control" id="tarifaCFE" type="text" name=""  placeholder="Precio">
				  											</div>
				  										</div>
			  										</div>
		  										</div>
		  									</div>
		  									<div class="col-md-6">
  												<div class="box box-primary ">
		  											<div class="box box-solid box-primary">
		  												<div class="box-body">
					  										<div class="form-froup">
																<button id="btnCalTarifa" onclick="" type="button" class="btn btn-xs btn-default">Calcular Tarifa</button>
																<br>
																<br>
																<p id = "demo"> Resultado de la tarifa </p>
																<br>
																<p><i>Si necesita consultar la tarifa correspondiente al periodo, consulte <a href="https://app.cfe.mx/Aplicaciones/CCFE/Tarifas/TarifasCRECasa/Tarifas/Tarifa1.aspx" target="_blank">aqui</a> la página de CFE</i></p>
															</div>
														</div>
	  												</div>
	  											</div>
	  										</div>	
		  								</div>
		  							</div>
  								</div>

  								<div class="box-body">

  									<br>

  									<h3 class="box-title">Grafica RealTime</h3>

	  								<div id="interactive_update" style="height: 300px;"></div>

								</div>

							</div>
  							<!-- /.box-body-->
  						</div>
  						<!-- /.box -->

  					</div>

  					<!-- /.col -->
  				</div>
  				<!-- /.row -->

  				<div class="row">
  					<div class="col-md-6">
  						<!-- Line chart -->

  						<!-- /.box -->

  						<!-- Area chart -->

  						<!-- /.box -->

  					</div>
  					<!-- /.col -->

  					<div class="col-md-6">
  						<!-- Bar chart -->
  						
  					</div>
  					<!-- /.col -->
  				</div>
  				<!-- /.row -->
  			</section>
  			<!-- /.content -->

  		</div>
  		<!-- /.content-wrapper -->
  		<footer class="main-footer">
  			<div class="pull-right hidden-xs">
  				<b>Version</b> 2.4.0
  			</div>
  			<strong>Copyright &copy; 2014-2016 <a href="https://adminlte.io">Almsaeed Studio</a>.</strong> All rights
  			reserved.
  		</footer>

  		<!-- Control Sidebar -->
  		<aside class="control-sidebar control-sidebar-dark">
  			<!-- Create the tabs -->
  			<ul class="nav nav-tabs nav-justified control-sidebar-tabs">
  				<li><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
  				<li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
  			</ul>
  			<!-- Tab panes -->
  			<div class="tab-content">
  				<!-- Home tab content -->
  				<div class="tab-pane" id="control-sidebar-home-tab">
  					<h3 class="control-sidebar-heading">Recent Activity</h3>
  					<ul class="control-sidebar-menu">
  						<li>
  							<a href="javascript:void(0)">
  								<i class="menu-icon fa fa-birthday-cake bg-red"></i>

  								<div class="menu-info">
  									<h4 class="control-sidebar-subheading">Langdon's Birthday</h4>

  									<p>Will be 23 on April 24th</p>
  								</div>
  							</a>
  						</li>
  						<li>
  							<a href="javascript:void(0)">
  								<i class="menu-icon fa fa-user bg-yellow"></i>

  								<div class="menu-info">
  									<h4 class="control-sidebar-subheading">Frodo Updated His Profile</h4>

  									<p>New phone +1(800)555-1234</p>
  								</div>
  							</a>
  						</li>
  						<li>
  							<a href="javascript:void(0)">
  								<i class="menu-icon fa fa-envelope-o bg-light-blue"></i>

  								<div class="menu-info">
  									<h4 class="control-sidebar-subheading">Nora Joined Mailing List</h4>

  									<p>nora@example.com</p>
  								</div>
  							</a>
  						</li>
  						<li>
  							<a href="javascript:void(0)">
  								<i class="menu-icon fa fa-file-code-o bg-green"></i>

  								<div class="menu-info">
  									<h4 class="control-sidebar-subheading">Cron Job 254 Executed</h4>

  									<p>Execution time 5 seconds</p>
  								</div>
  							</a>
  						</li>
  					</ul>
  					<!-- /.control-sidebar-menu -->

  					<h3 class="control-sidebar-heading">Tasks Progress</h3>
  					<ul class="control-sidebar-menu">
  						<li>
  							<a href="javascript:void(0)">
  								<h4 class="control-sidebar-subheading">
  									Custom Template Design
  									<span class="label label-danger pull-right">70%</span>
  								</h4>

  								<div class="progress progress-xxs">
  									<div class="progress-bar progress-bar-danger" style="width: 70%"></div>
  								</div>
  							</a>
  						</li>
  						<li>
  							<a href="javascript:void(0)">
  								<h4 class="control-sidebar-subheading">
  									Update Resume
  									<span class="label label-success pull-right">95%</span>
  								</h4>

  								<div class="progress progress-xxs">
  									<div class="progress-bar progress-bar-success" style="width: 95%"></div>
  								</div>
  							</a>
  						</li>
  						<li>
  							<a href="javascript:void(0)">
  								<h4 class="control-sidebar-subheading">
  									Laravel Integration
  									<span class="label label-warning pull-right">50%</span>
  								</h4>

  								<div class="progress progress-xxs">
  									<div class="progress-bar progress-bar-warning" style="width: 50%"></div>
  								</div>
  							</a>
  						</li>
  						<li>
  							<a href="javascript:void(0)">
  								<h4 class="control-sidebar-subheading">
  									Back End Framework
  									<span class="label label-primary pull-right">68%</span>
  								</h4>

  								<div class="progress progress-xxs">
  									<div class="progress-bar progress-bar-primary" style="width: 68%"></div>
  								</div>
  							</a>
  						</li>
  					</ul>
  					<!-- /.control-sidebar-menu -->

  				</div>
  				<!-- /.tab-pane -->
  				<!-- Stats tab content -->
  				<div class="tab-pane" id="control-sidebar-stats-tab">Stats Tab Content</div>
  				<!-- /.tab-pane -->
  				<!-- Settings tab content -->
  				<div class="tab-pane" id="control-sidebar-settings-tab">
  					<form method="post">
  						<h3 class="control-sidebar-heading">General Settings</h3>

  						<div class="form-group">
  							<label class="control-sidebar-subheading">
  								Report panel usage
  								<input type="checkbox" class="pull-right" checked>
  							</label>

  							<p>
  								Some information about this general settings option
  							</p>
  						</div>
  						<!-- /.form-group -->

  						<div class="form-group">
  							<label class="control-sidebar-subheading">
  								Allow mail redirect
  								<input type="checkbox" class="pull-right" checked>
  							</label>

  							<p>
  								Other sets of options are available
  							</p>
  						</div>
  						<!-- /.form-group -->

  						<div class="form-group">
  							<label class="control-sidebar-subheading">
  								Expose author name in posts
  								<input type="checkbox" class="pull-right" checked>
  							</label>

  							<p>
  								Allow the user to show his name in blog posts
  							</p>
  						</div>
  						<!-- /.form-group -->

  						<h3 class="control-sidebar-heading">Chat Settings</h3>

  						<div class="form-group">
  							<label class="control-sidebar-subheading">
  								Show me as online
  								<input type="checkbox" class="pull-right" checked>
  							</label>
  						</div>
  						<!-- /.form-group -->

  						<div class="form-group">
  							<label class="control-sidebar-subheading">
  								Turn off notifications
  								<input type="checkbox" class="pull-right">
  							</label>
  						</div>
  						<!-- /.form-group -->

  						<div class="form-group">
  							<label class="control-sidebar-subheading">
  								Delete chat history
  								<a href="javascript:void(0)" class="text-red pull-right"><i class="fa fa-trash-o"></i></a>
  							</label>
  						</div>
  						<!-- /.form-group -->
  					</form>
  				</div>
  				<!-- /.tab-pane -->
  			</div>
  		</aside>
  		<!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
  	immediately after the control sidebar -->
  	<div class="control-sidebar-bg"></div>
  </div>
  <!-- ./wrapper -->

  <!-- jQuery 3 -->
  <script src="./bower_components/jquery/dist/jquery.min.js"></script>
  <!-- FastClick -->
  <script src="./bower_components/fastclick/lib/fastclick.js"></script>
  <!-- FLOT CHARTS -->
  <script src="./bower_components/Flot/jquery.flot.js"></script>
  <!-- FLOT RESIZE PLUGIN - allows the chart to redraw when the window is resized -->
  <script src="./bower_components/Flot/jquery.flot.resize.js"></script>
  <!-- FLOT PIE PLUGIN - also used to draw donut charts -->
  <script src="./bower_components/Flot/jquery.flot.pie.js"></script>
  <!-- FLOT CATEGORIES PLUGIN - Used to draw bar charts -->
  <script src="./bower_components/Flot/jquery.flot.categories.js"></script>
  <!-- Page script -->
  <script src="./bower_components/Flot/jquery.flot.axislabels.js"></script>
  <!-- label axes -->

  <script>


  	$(function () {
  		

  		var irms; 
  		var plotIRMS = [];
  		var FMIN;
  		var FMAX;
  		var Update_FMIN;
  		var Update_FMAX;

  		var FTMINH;
  		var FTMAXH;

  		var flag_state = false;

  		

  		function setFunctionMin(){
  			FTMINH = document.getElementById("hoursfmin").value + ":" + document.getElementById("minutesfmin").value;
  			alert(FTMINH);
  		}

  		
  		function setFunctionMax(){
  			FTMAXH = document.getElementById("hoursfmax").value + ":" + document.getElementById("minutesfmax").value;
  			alert(FTMAXH);
  		}

  		$( "#btnRefresh" ).click(function() {
	  		//alert("HELLO");
	  		setFunctionMin();
	  		setFunctionMax();
	  		getHistory();
	  		//getData(); 
	  	})

	  	$( "#btnSend" ).click(function() {
	  		//alert("HELLO");
	  		if (flag_state === false) {
	  			flag_state = true;
	  			alert(flag_state);
	  			//return;
	  		} else {
	  			flag_state = false;
	  			alert(flag_state);
	  		}


	  		//updateTotal(); 
	  	})

	  	$( "#btnCalTarifa" ).click(function() {
	  		var suma = 0;
	  		var potencia = 0.0; 
	  		var wattHours = 0.0;
	  		var costoConsumo = 0.0;
	  		var voltaje = 127.0;


	  		if (FMIN && FMAX){
	  			var costo = Number(document.getElementById("tarifaCFE").value);
	  			var dateMin = new Date(FMIN);
	  			//console.log( 'dateMin', dateMin)
	  			var dateMax = new Date(FMAX);
	  			//console.log( 'dateMin', dateMax)

		  		var datePromedio = dateMax - dateMin;
		  		var datePromedioTotal = datePromedio/3600000;
		  		console.log( 'dateProm', datePromedioTotal)
		  		//console.log( 'plotIRMS', plotIRMS)
		  		plotIRMS.forEach( x => {
		  			
		  			var iRMS = x[1]
					//console.log('iRms', iRMS);


		  			if (iRMS !== NaN){
	  					suma = suma + iRMS;
	  					//console.log(suma);
	  				}
	  			});

	  			potencia = suma * voltaje;
	  			var kW = potencia / 1000; 
	  			wattHours = kW / datePromedioTotal;
	  			console.log('potencia : ', potencia);
	  			console.log('wattHora : ', wattHours);

	  			costoConsumo = wattHours * costo;

	  			document.getElementById("demo").innerHTML = costoConsumo.toString();

  			}
	  		else{

	  			alert("Usted no ha realizado una busqueda de historial");
	  			document.getElementById("demo").innerHTML = "Error";
	  			return;

	  		}


  			

  			


	  	})

	  	delay = 2000;
		setInterval(() => {

    	currentDate = Date.now();
    	fetch = new Date(currentDate - delay);

    	Update_FMAX =
	        fetch.getFullYear().toString().padStart(2, '0')
	        + '-' +
	        (fetch.getMonth() +1 ).toString().padStart(2, '0')
	        + '-' +
	        fetch.getDate().toString().padStart(2, '0') 
	        + '%20' +
	        fetch.getHours().toString().padStart(2, '0')
	        + ':' +
	        fetch.getMinutes().toString().padStart(2, '0')
	        + ':' +
	        fetch.getSeconds().toString().padStart(2, '0')
	        ;

        Update_FMIN =
	        fetch.getFullYear().toString().padStart(2, '0')
	        + '-' +
	        (fetch.getMonth() +1 ).toString().padStart(2, '0')
	        + '-' +
	        fetch.getDate().toString().padStart(2, '0') 
	        + '%20' +
	        fetch.getHours().toString().padStart(2, '0')
	        + ':' +
	        (fetch.getMinutes()-3).toString().padStart(2, '0')
	        + ':' +
	        fetch.getSeconds().toString().padStart(2, '0')
	        ;

    		console.log('fetchInitTime', Update_FMIN);
    		console.log('fetchEndTime', Update_FMAX);
    		// pedir con ajax los datos con fecha mayor a dateString
    		updateTotal()

		}, delay)



	

			

    /*
     * Flot Interactive Chart
     * -----------------------
     */

    
    function getHistory() {

    	var url = 'http://0.0.0.0:5000/api/consult?';

    	var id = document.getElementById("idDevice").value;
    	//alert(id);

    	var fmin = document.getElementById("fmin").value;
    	//alert(fmin);

    	//var ftmin = document.getElementById("tmin").value;
    	//alert(ftmin);

    	var fmax = document.getElementById("fmax").value;
    	//alert(fmax);

    	//var ftmax = document.getElementById("tmax").value;
    	//alert(ftmax);



        FMIN = fmin + " " + FTMINH;
        //console.log(typeof(FMIN))
        FMAX = fmax + " " + FTMAXH;
        //console.log(typeof(FMAX))

    	if ( id ) {
    		url = url + 'id=' + id;
    	}
    	if( fmin ) {
    		url = url + '&fmin=' + FMIN;
    	}

    	if( fmax ) {
    		url = url + '&fmax=' + FMAX;
    	}
    	

    	alert(url);

    	//console.log("Hi")
    	$.ajax({
    		type: "GET",
    		url: url,
    		data: "check",
    		timeout: 30000,
    		success: function(data){
    			alert("HELLO");
    			console.log("data",data);
    			//console.log('IRMS:', data.results[1].irms);

    			if (data.results.length === 0){
    				alert("Fuera de rango de fechas");
    			}

    			//irms = data; 

    		    plotIRMS = []; 
  				var i = 0; 
  				data.results.forEach( function(value, idx) {
  				if( idx % 2 === 0 ){
  					plotIRMS.push( [ idx, value.irms ] );
  				}
  			});

  			console.log('irms', plotIRMS);
  			interactive_plot.setData( [plotIRMS]  );
  			interactive_plot.setupGrid();
  			interactive_plot.draw();


    			//setTimeout( getData, 1000 );
    		},
    		error: function(xhr, status, error){
    			alert("ERROR");
    			console.log("status", status);
    			console.log("error",error);    		
    		}

    	});
    	//console.log('bye');
    }

  

  var interactive_plot = $.plot('#interactive', [], {
  	grid  : {
  		borderColor: '#f3f3f3',
  		borderWidth: 1,
  		tickColor  : '#f3f3f3'
  	},
  	series: {
        shadowSize: 0, // Drawing is faster without shadows
        color     : '#1FF2CF'
	},
    lines : {
        fill : true, //Converts the line chart to area chart
        color: '#1FF2CF'
    },
    yaxis : {
    	show: true,
    	position: "left",
    	ticks: [0.0, 10.0]

    },
    xaxis : {
    	show: false
    },
    axisLabels: {
            show: true
        },
        xaxes: [{
        	position:'bottom',
            axisLabel: 'Tiempo',
        }],
        yaxes: [{
            position: 'left',
            axisLabel: 'Consumo de Corriente [A]',
        }]
});

  var interactive_plot_update = $.plot('#interactive_update', [], {
  	grid  : {
  		borderColor: '#f3f3f3',
  		borderWidth: 1,
  		tickColor  : '#f3f3f3'
  	},
  	series: {
        shadowSize: 0, // Drawing is faster without shadows
        color     : '#1FF2CF'
	},
    lines : {
        fill : true, //Converts the line chart to area chart
        color: '#1FF2CF'
    },
    yaxis : {
    	show: true,
    	position: "left",
    	ticks: [0.0, 10.0]

    },
    xaxis : {
    	show: false
    },
    axisLabels: {
            show: true
        },
        xaxes: [{
        	position:'bottom',
            axisLabel: 'Tiempo',
        }],
        yaxes: [{
            position: 'left',
            axisLabel: 'Consumo de Corriente [A]',
        }]
});


	function updateTotal() {

		if(flag_state === true ){

			console.log('activated');

		  	var url = 'http://0.0.0.0:5000/api/consult?';

		  	var id = document.getElementById("idDevice").value;

		  	if ( !id ) {
		    	alert( "Falta el Id del dispositivo")
		    	return; 
		    }

			url = url + 'id=' + id;

		  	url = url + '&fmin=' + Update_FMIN + '&fmax=' + Update_FMAX;

		  	console.log("Get")
		  	$.ajax({
		  		type: "GET",
		  		url: url,
		  		data: "check",
		  		success: function(data){
		  			console.log("data",data);
		  			console.log('IRMS:', data.results[1].irms);

		  			plotIRMS = []; 
		  			var i = 0; 
		  			data.results.forEach( function(value, idx) {
		  				if( idx % 2 === 0 ){
		  					plotIRMS.push( [ idx, value.irms ] );
		  				}
		  			});

		  			console.log('irms', plotIRMS);
		  			interactive_plot_update.setData( [plotIRMS]  );
		  			interactive_plot_update.setupGrid();
		  			interactive_plot_update.draw();

		    			//setTimeout( getData, 1000 );
		    		},
				error: function(xhr, status, error){
		    			console.log("status", status);
		    			console.log("error",error);    		
		    		}

		    	});
		  	console.log('bye');
		}
		else{
			console.log('stopped');
		}

    }


})


  	function labelFormatter(label, series) {
  		return '<div style="font-size:13px; text-align:center; padding:2px; color: #fff; font-weight: 600;">'
  		+ label
  		+ '<br>'
  		+ Math.round(series.percent) + '%</div>'
  	}
  </script>
</body>
</html>
